image: python:3.7

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
  PRE_COMMIT_HOME: ${CI_PROJECT_DIR}/.cache/pre-commit

cache:
  key: "$CI_JOB_NAME-$CI_COMMIT_REF_SLUG"
  paths:
    - .nox/
    - .cache/pip
    - apt-cache/
    - ${PRE_COMMIT_HOME}
  policy: pull

before_script:
  - export APT_CACHE_DIR=`pwd`/apt-cache && mkdir -pv $APT_CACHE_DIR
  - apt-get update -yq && apt-get -o dir::cache::archives="$APT_CACHE_DIR" upgrade -y
  - pip install nox

# test:
#  script:
#    - nox --sessions tests

lint:
  script:
  - nox --sessions lint

bandit:
  script:
    - nox --sessions bandit


pyreverse:
  script:
    - apt-get -qq update
    - apt-get -qq install -y graphviz
    - nox --sessions pyreverse
